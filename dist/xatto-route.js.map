{"version":3,"file":"xatto-route.js","sources":["../src/Route.ts","../src/RouteLink.tsx","../src/setPopstateHandle.ts"],"sourcesContent":["export function Route({ xa: { context, extra }, ...attrs }, children) {\n  const location = attrs.location || context.location || extra.location || window.location\n\n  let flags = attrs.flags || ''\n  let pattern: RegExp | string | undefined = attrs.pattern\n\n  if (null == pattern) {\n    pattern = ''\n  } else if (pattern instanceof RegExp) {\n    flags = flags || (pattern as any).flags || ''\n    pattern = pattern.source\n  }\n\n  pattern = pattern[0] === '^' ? pattern.slice(1) : pattern\n  pattern = pattern[0] === '/' ? pattern.slice(1) : pattern\n  pattern = new RegExp(`^/${pattern}`)\n\n  const match: any = pattern.exec(location.pathname)\n\n  const child = children[0]\n\n  return match && {\n    ...child,\n    attributes: {\n      ...child.attributes,\n      route: {\n        location,\n        match,\n        params: match.groups || {},\n        path: match[0],\n        pattern,\n      }\n    }\n  }\n}\n","import { x } from 'xatto'\n\nfunction getOrigin(loc, location) {\n  const protocol = (loc.protocol && ':' !== loc.protocol) ? loc.protocol : location.protocol\n  const host = [loc.hostname, loc.port].filter(Boolean).join(\":\")\n    || [location.hostname, location.port].filter(Boolean).join(\":\")\n  return protocol + \"//\" + host\n}\n\nexport function RouteLink({ xa: { extra }, ...attrs }, children) {\n  const href = attrs.href\n  const onclick = attrs.onclick\n\n  attrs.onclick = (e, ctx, ext) => {\n    if (onclick) {\n      onclick(e, ctx, ext)\n    }\n\n    if (!e.defaultPrevented\n      && e.button === 0\n      && !e.altKey\n      && !e.metaKey\n      && !e.ctrlKey\n      && !e.shiftKey\n      && attrs.target !== \"_blank\") {\n\n      return (mutate, context) => {\n        const location = attrs.location || context.location || extra.location || window.location\n\n        if (getOrigin(location, location) === getOrigin(e.currentTarget, location)) {\n          e.preventDefault()\n\n          const pathname = location.pathname\n          if (href !== pathname) {\n            history.pushState(pathname, \"\", href)\n\n            mutate()\n          }\n        }\n      }\n    }\n  }\n\n  return (\n    <a {...attrs}>\n      {children}\n    </a>\n  )\n}\n","export function setPopstateHandle(mutate: Function) {\n  const handle = (e) => {\n    mutate()\n  }\n\n  addEventListener('popstate', handle)\n\n  return () => {\n    removeEventListener('popstate', handle)\n  }\n}\n"],"names":["x"],"mappings":"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"}