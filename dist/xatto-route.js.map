{"version":3,"file":"xatto-route.js","sources":["../src/Route.ts","../src/RouteLink.tsx","../src/setPopstateHandle.ts"],"sourcesContent":["import { x } from 'xatto'\n\nexport function Route({ xa: { context, extra }, ...props }: any, children) {\n  const location = props.location || context.location || extra.location || document.location || window.location\n\n  let flags = props.flags || ''\n  let pattern: RegExp | string | undefined = props.pattern\n\n  if (null == pattern) {\n    pattern = ''\n  } else if (pattern instanceof RegExp) {\n    flags = flags || (pattern as any).flags || ''\n    pattern = pattern.source\n  }\n\n  pattern = pattern[0] === '^' ? pattern.slice(1) : pattern\n  pattern = pattern[0] === '/' ? pattern.slice(1) : pattern\n  pattern = new RegExp(`^/${pattern}`)\n\n  const match: any = pattern.exec(location.pathname)\n\n  if (!match) {\n    return false\n  }\n\n  const route = {\n    location,\n    match,\n    params: match.groups || {},\n    path: match[0],\n    pattern,\n  }\n\n  return x(x, {}, children.map(child => {\n    child.props.route = route\n    return child\n  }))\n}\n","import { x, currentOnly } from 'xatto'\nimport { VNode } from 'xatto/src/VNode'\n\nfunction getOrigin(loc, location) {\n  const protocol = (loc.protocol && ':' !== loc.protocol) ? loc.protocol : location.protocol\n  const host = [loc.hostname, loc.port].filter(Boolean).join(\":\")\n    || [location.hostname, location.port].filter(Boolean).join(\":\")\n  return protocol + \"//\" + host\n}\n\nexport function RouteLink({ xa: { extra }, ...props }: any, children) {\n  return (\n    <a\n      {...props}\n\n      onclick={onClick}\n      tier={props}\n    >\n      {children}\n    </a>\n  ) as VNode\n}\n\nfunction onClick(context, detail, props, event) {\n  const newContext = onClickMain(context, detail, props, event)\n\n  if (props.tier.onclick) {\n    return props.tier.onclick(context, detail, props, event) || newContext\n  }\n\n  return newContext\n}\n\nfunction onClickMain (context, detail, props, event) {\n  if (!event.defaultPrevented\n    && event.button === 0\n    && !event.altKey\n    && !event.metaKey\n    && !event.ctrlKey\n    && !event.shiftKey\n    && props.target !== \"_blank\") {\n\n    const location = props.location || context.location || props.xa.extra.location || window.location\n    if (getOrigin(location, location) === getOrigin(event.currentTarget, location)) {\n      event.preventDefault()\n\n      const href = props.href\n      const pathname = location.pathname\n      if (href !== pathname) {\n        history.pushState(pathname, \"\", href)\n\n        return {}  // mutate\n      }\n    }\n  }\n}\n","export function setPopstateHandle(mutate: Function) {\n  const handle = (e) => {\n    mutate({})\n  }\n\n  addEventListener('popstate', handle)\n\n  return () => {\n    removeEventListener('popstate', handle)\n  }\n}\n"],"names":["x"],"mappings":"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"}